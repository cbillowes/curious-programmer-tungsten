---
title:  "How I discovered a security vulnerability with our router"
cover: 'https://picsum.photos/1600/800/?image=532'
date:   2015-08-09
tags:
  - Security
  - Router
  - Telnet
  - CLI
---

> (Ported from my old blog called _Thinky_)

We have a Huawei HG532 wireless router at home. It is permanently connected to a DSL line with a static IP address. I woke up on a Sunday morning ready to watch some [Pluralsight](https://www.pluralsight.com/) videos but the Internet was down. I connected to the router via HTTP and diagnosed the connectivity. It was up and down so very unstable. I remotely rebooted it, hard rebooted it after a 30 second wait, checked for device interference and peeked at the logs. The fault was something outside of my control and all I could do was wait a while and then call the service provider.

I became very interested in the router simply because I didn't like the web interface and wanted to change it. I need to access its file system, find the files and change the stylesheet.

I tried to connect to the router over the Windows network in the file system but it didn't allow me. I installed [Telnet](https://en.wikipedia.org/wiki/Telnet) and opened a connection to the internal IP address. It worked!

![alt text](/assets/posts/2015-08-09-router-telnet-shell.png "Telnet to Router - ATP CLI")

When I tried to log in using the non-default admin username and password it didn't work. I then tried the [default password](http://portforward.com/default_username_password/Huawei.htm) which worked. Not cool! The telnet connection gives you access to the routers ATP CLI. I closed the connection and opened a new telnet connection to the public IP and it also worked. Anyone from the outside could get access to my router.

Is started researching the [ATP CLI](https://huaweihg612hacking.wordpress.com/2011/07/17/the-atp-cli-and-equipcmd/) and realised the severity of the exposure. Anyone could access the router's shell from the outside! My priorities quickly changed from a pretty UI to securing my router.

I reasoned that default passwords should be configurable somewhere. If I were a configurable password I would probably be in a configuration file somewhere. I logged into the web interface and downloaded the configuration file. It is an XML file that contains all the username and passwords in clear text. I changed the CLI password under the `X_Cli` node and uploaded the changed file.

I felt a bit better but was annoyed that the [manual](http://www.manualsbase.com/manual/238143/network_router/huawei/huawei_technologies_network_router_hg532/) never mentioned any of this cool stuff. I

I carried on playing around in the CLI shell.

* When I was poking around the logs earlier I noticed that the system clock was a date long in the past. I updated the date and time `date -s 080911262015`
* I browsed the file structure using `ls` and `cd`, `ch -` (go back), `cd --` (back to root).
* Viewed file contents of some files `cat filename.ext`.
* Press tab in `#` lists all available commands.

If I never wanted to change the UI of the silly web interface I would never have know about this. As a software developer, curiosity is key! How well do you know your router?

### References

* [Simple Router Pawning Techniques – Getting the Administrative Privileges](http://resources.infosecinstitute.com/router-pawning/)
* [/dev/ttyS0 Embedded Device Hacking Blog](http://www.devttys0.com/blog/)
* [How to configure the Comtrend’s HG532c ADSL router ARP table for (WOL) Wake On Lan from internet using expect](http://www.elsotanillo.net/2012/05/how-to-configure-the-comtrends-hg532c-adsl-router-arp-table-for-wol-wake-on-lan-from-internet-using-expect/)
* [Vulnerability in embedded Web server exposes millions of routers to hacking](http://www.pcworld.com/article/2861232/vulnerability-in-embedded-web-server-exposes-millions-of-routers-to-hacking.html)
